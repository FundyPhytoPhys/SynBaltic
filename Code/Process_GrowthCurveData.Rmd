---
title: "Process_GrowthCurveData"
author:
- Sylwia Sliwinska-Wilczewska
- Douglas A. Campbell
date: "`r format(Sys.Date())`"
output:
bookdown::html_document2:
    code_folding: show
    keep_md: yes
    toc: TRUE
    toc_float: TRUE
    toc_depth: 6
    fig_caption: yes
bibliography: BalticPhotoperiod.bib
csl: plos-one.csl
editor_options: 
  markdown: 
    wrap: 72
---

# Set Chunk Options

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
knitr::opts_chunk$set(fig.path='Figs/')
```

# Introduction

Process_GrowthCurveData.Rmd separately processes and combines all .Rds from Data/ImportedData/ImportedMCData folder. This .Rmd generates Baltic_Photoperiod_Processed_GrowthCurve.Rds (stored in Data/ProcessedData/ProcessedGrowthCurveData folder) and GrowthCurve_SupPlot.png (stored in Output/Plots folder).

# Load Libraries and set Project Variables

```{r load libraries} 
library(tidyverse)
library(lubridate)
library(stringr)
library(broom)
library(knitr)
library(OneR)
library(zoo)
library(ggpubr)
library(data.table)
library(googledrive)
library(googlesheets4)
```

```{r set project variables}
Project <- "SynBaltic"
DataOut <- file.path("..", "Data", "ProcessedData", "ProcessedGrowthCurveData")
DataIn <- file.path("..", "Data", "ImportedData", "ImportedMCData", fsep = .Platform$file.sep)

PlotsPath <- file.path("..", "Output", "Plots")
RDSPlotPath <- file.path("..", "Output", "PlotsRDS")

FileEncode <- "UTF-8" 
Delimiter <- ""
HeaderRows <- 0
```

# List and read imported MC files

```{r Exported Rmd only first time in session}
list.files(path = DataIn, full.names = TRUE)
```

# Import selected Rds and calculate mean OD from every hour based on ToD and time

## Import Run34

```{r Import Run and calculate mean OD, echo = FALSE, warning = FALSE}
MultiCultiFile <- "../Data/ImportedData/ImportedMCData/20211113_PICO_MCMIX004_RUN34_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  

MultiCultiData$ToD = sub("\\..*", "", MultiCultiData$ToD)
MultiCultiData$time = sub("\\..*", "", MultiCultiData$time)

MultiCultiData <- MultiCultiData %>% 
  mutate(ToD=as.numeric(ToD)) %>% 
  mutate(time=as.numeric(time)) %>% 
  mutate(Actinic_par = Actinic_par/1000) %>% 
  rename(time_h=time) %>% 
  mutate(DeltaOD = OD680-OD720) 
  
MultiCultiData34 <- MultiCultiData %>%   
  group_by(SampleID, Day, ToD, time_h) %>% 
  summarize(Run, SampleID, Strain, ExpDate, Filename, Tube, time_h, ToD, Day, ExpDate, Actinic_par, OD680, OD720, DeltaOD, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, meanActinic_par_h = mean(Actinic_par), meanOD680_h = mean(OD680), meanOD720_h = mean(OD720), meanDeltaOD_h = mean(DeltaOD)) %>%
  ungroup() %>% 
  select(-c(Actinic_par, OD680, OD720, DeltaOD)) %>% 
  unique()
```

## Import Run50

```{r Import Run and calculate mean OD, echo = FALSE, warning = FALSE}
MultiCultiFile <- "../Data/ImportedData/ImportedMCData/20220206_PICO_MC257_RUN50_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  

MultiCultiData$ToD = sub("\\..*", "", MultiCultiData$ToD)
MultiCultiData$time = sub("\\..*", "", MultiCultiData$time)

MultiCultiData <- MultiCultiData %>% 
  mutate(ToD=as.numeric(ToD)) %>% 
  mutate(time=as.numeric(time)) %>% 
  mutate(Actinic_par = Actinic_par/1000) %>% 
  rename(time_h=time) %>% 
  mutate(DeltaOD = OD680-OD720) 
  
MultiCultiData50 <- MultiCultiData %>%   
  group_by(SampleID, Day, ToD, time_h) %>% 
  summarize(Run, SampleID, Strain, ExpDate, Filename, Tube, time_h, ToD, Day, ExpDate, Actinic_par, OD680, OD720, DeltaOD, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, meanActinic_par_h = mean(Actinic_par), meanOD680_h = mean(OD680), meanOD720_h = mean(OD720), meanDeltaOD_h = mean(DeltaOD)) %>%
  ungroup() %>% 
  select(-c(Actinic_par, OD680, OD720, DeltaOD)) %>% 
  unique()
```

## Import Run60

```{r Import Run and calculate mean OD, echo = FALSE, warning = FALSE}
MultiCultiFile <- "../Data/ImportedData/ImportedMCData/20220405_PICO_MC247_RUN60_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  

MultiCultiData$ToD = sub("\\..*", "", MultiCultiData$ToD)
MultiCultiData$time = sub("\\..*", "", MultiCultiData$time)

MultiCultiData <- MultiCultiData %>% 
  mutate(ToD=as.numeric(ToD)) %>% 
  mutate(time=as.numeric(time)) %>% 
  mutate(Actinic_par = Actinic_par/1000) %>% 
  rename(time_h=time) %>% 
  mutate(DeltaOD = OD680-OD720) 
  
MultiCultiData60 <- MultiCultiData %>%   
  group_by(SampleID, Day, ToD, time_h) %>% 
  summarize(Run, SampleID, Strain, ExpDate, Filename, Tube, time_h, ToD, Day, ExpDate, Actinic_par, OD680, OD720, DeltaOD, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, meanActinic_par_h = mean(Actinic_par), meanOD680_h = mean(OD680), meanOD720_h = mean(OD720), meanDeltaOD_h = mean(DeltaOD)) %>%
  ungroup() %>% 
  select(-c(Actinic_par, OD680, OD720, DeltaOD)) %>% 
  unique()
```

## Import Run62

```{r Import Run and calculate mean OD, echo = FALSE, warning = FALSE}
MultiCultiFile <- "../Data/ImportedData/ImportedMCData/20220410_PICO_MC257_RUN62_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  

MultiCultiData$ToD = sub("\\..*", "", MultiCultiData$ToD)
MultiCultiData$time = sub("\\..*", "", MultiCultiData$time)

MultiCultiData <- MultiCultiData %>% 
  mutate(ToD=as.numeric(ToD)) %>% 
  mutate(time=as.numeric(time)) %>% 
  mutate(Actinic_par = Actinic_par/1000) %>% 
  rename(time_h=time) %>% 
  mutate(DeltaOD = OD680-OD720) 
  
MultiCultiData62 <- MultiCultiData %>%   
  group_by(SampleID, Day, ToD, time_h) %>% 
  summarize(Run, SampleID, Strain, ExpDate, Filename, Tube, time_h, ToD, Day, ExpDate, Actinic_par, OD680, OD720, DeltaOD, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, meanActinic_par_h = mean(Actinic_par), meanOD680_h = mean(OD680), meanOD720_h = mean(OD720), meanDeltaOD_h = mean(DeltaOD)) %>%
  ungroup() %>% 
  select(-c(Actinic_par, OD680, OD720, DeltaOD)) %>% 
  unique()
```

## Import Run64

```{r Import Run and calculate mean OD, echo = FALSE, warning = FALSE}
MultiCultiFile <- "../Data/ImportedData/ImportedMCData/20220413_PICO_MC247_RUN64_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  

MultiCultiData$ToD = sub("\\..*", "", MultiCultiData$ToD)
MultiCultiData$time = sub("\\..*", "", MultiCultiData$time)

MultiCultiData <- MultiCultiData %>% 
  mutate(ToD=as.numeric(ToD)) %>% 
  mutate(time=as.numeric(time)) %>% 
  mutate(Actinic_par = Actinic_par/1000) %>% 
  rename(time_h=time) %>% 
  mutate(DeltaOD = OD680-OD720) 
  
MultiCultiData64 <- MultiCultiData %>%   
  group_by(SampleID, Day, ToD, time_h) %>% 
  summarize(Run, SampleID, Strain, ExpDate, Filename, Tube, time_h, ToD, Day, ExpDate, Actinic_par, OD680, OD720, DeltaOD, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, meanActinic_par_h = mean(Actinic_par), meanOD680_h = mean(OD680), meanOD720_h = mean(OD720), meanDeltaOD_h = mean(DeltaOD)) %>%
  ungroup() %>% 
  select(-c(Actinic_par, OD680, OD720, DeltaOD)) %>% 
  unique()
```

## Import Run65

```{r Import Run and calculate mean OD, echo = FALSE, warning = FALSE}
MultiCultiFile <- "../Data/ImportedData/ImportedMCData/20220420_PICO_MC257_RUN65_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  

MultiCultiData$ToD = sub("\\..*", "", MultiCultiData$ToD)
MultiCultiData$time = sub("\\..*", "", MultiCultiData$time)

MultiCultiData <- MultiCultiData %>% 
  mutate(ToD=as.numeric(ToD)) %>% 
  mutate(time=as.numeric(time)) %>% 
  mutate(Actinic_par = Actinic_par/1000) %>% 
  rename(time_h=time) %>% 
  mutate(DeltaOD = OD680-OD720) 
  
MultiCultiData65 <- MultiCultiData %>%   
  group_by(SampleID, Day, ToD, time_h) %>% 
  summarize(Run, SampleID, Strain, ExpDate, Filename, Tube, time_h, ToD, Day, ExpDate, Actinic_par, OD680, OD720, DeltaOD, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, meanActinic_par_h = mean(Actinic_par), meanOD680_h = mean(OD680), meanOD720_h = mean(OD720), meanDeltaOD_h = mean(DeltaOD)) %>%
  ungroup() %>% 
  select(-c(Actinic_par, OD680, OD720, DeltaOD)) %>% 
  unique()
```

## Import Run67

```{r Import Run and calculate mean OD, echo = FALSE, warning = FALSE}
MultiCultiFile <- "../Data/ImportedData/ImportedMCData/20220422_PICO_MC247_RUN67_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  

MultiCultiData$ToD = sub("\\..*", "", MultiCultiData$ToD)
MultiCultiData$time = sub("\\..*", "", MultiCultiData$time)

MultiCultiData <- MultiCultiData %>% 
  mutate(ToD=as.numeric(ToD)) %>% 
  mutate(time=as.numeric(time)) %>% 
  mutate(Actinic_par = Actinic_par/1000) %>% 
  rename(time_h=time) %>% 
  mutate(DeltaOD = OD680-OD720) 
  
MultiCultiData67 <- MultiCultiData %>%   
  group_by(SampleID, Day, ToD, time_h) %>% 
  summarize(Run, SampleID, Strain, ExpDate, Filename, Tube, time_h, ToD, Day, ExpDate, Actinic_par, OD680, OD720, DeltaOD, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, meanActinic_par_h = mean(Actinic_par), meanOD680_h = mean(OD680), meanOD720_h = mean(OD720), meanDeltaOD_h = mean(DeltaOD)) %>%
  ungroup() %>% 
  select(-c(Actinic_par, OD680, OD720, DeltaOD)) %>% 
  unique()
```

## Import Run75

```{r Import Run and calculate mean OD, echo = FALSE, warning = FALSE}
MultiCultiFile <- "../Data/ImportedData/ImportedMCData/20220607_PICO_MC247_RUN75_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  

MultiCultiData$ToD = sub("\\..*", "", MultiCultiData$ToD)
MultiCultiData$time = sub("\\..*", "", MultiCultiData$time)

MultiCultiData <- MultiCultiData %>% 
  mutate(ToD=as.numeric(ToD)) %>% 
  mutate(time=as.numeric(time)) %>% 
  mutate(Actinic_par = Actinic_par/1000) %>% 
  rename(time_h=time) %>% 
  mutate(DeltaOD = OD680-OD720) 
  
MultiCultiData75 <- MultiCultiData %>%   
  group_by(SampleID, Day, ToD, time_h) %>% 
  summarize(Run, SampleID, Strain, ExpDate, Filename, Tube, time_h, ToD, Day, ExpDate, Actinic_par, OD680, OD720, DeltaOD, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, meanActinic_par_h = mean(Actinic_par), meanOD680_h = mean(OD680), meanOD720_h = mean(OD720), meanDeltaOD_h = mean(DeltaOD)) %>%
  ungroup() %>% 
  select(-c(Actinic_par, OD680, OD720, DeltaOD)) %>% 
  unique()
```

## Import Run77

```{r Import Run and calculate mean OD, echo = FALSE, warning = FALSE}
MultiCultiFile <- "../Data/ImportedData/ImportedMCData/20220615_PICO_MC257_RUN77_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  

MultiCultiData$ToD = sub("\\..*", "", MultiCultiData$ToD)
MultiCultiData$time = sub("\\..*", "", MultiCultiData$time)

MultiCultiData <- MultiCultiData %>% 
  mutate(ToD=as.numeric(ToD)) %>% 
  mutate(time=as.numeric(time)) %>% 
  mutate(Actinic_par = Actinic_par/1000) %>% 
  rename(time_h=time) %>% 
  mutate(DeltaOD = OD680-OD720) 
  
MultiCultiData77 <- MultiCultiData %>%   
  group_by(SampleID, Day, ToD, time_h) %>% 
  summarize(Run, SampleID, Strain, ExpDate, Filename, Tube, time_h, ToD, Day, ExpDate, Actinic_par, OD680, OD720, DeltaOD, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, meanActinic_par_h = mean(Actinic_par), meanOD680_h = mean(OD680), meanOD720_h = mean(OD720), meanDeltaOD_h = mean(DeltaOD)) %>%
  ungroup() %>% 
  select(-c(Actinic_par, OD680, OD720, DeltaOD)) %>% 
  unique()
```

## Import Run121

```{r Import Run and calculate mean OD, echo = FALSE, warning = FALSE}
MultiCultiFile <- "../Data/ImportedData/ImportedMCData/20230816_PICO_MC257_RUN121_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  

MultiCultiData$ToD = sub("\\..*", "", MultiCultiData$ToD)
MultiCultiData$time = sub("\\..*", "", MultiCultiData$time)

MultiCultiData <- MultiCultiData %>% 
  mutate(ToD=as.numeric(ToD)) %>% 
  mutate(time=as.numeric(time)) %>% 
  mutate(Actinic_par = Actinic_par/1000) %>% 
  rename(time_h=time) %>% 
  mutate(DeltaOD = OD680-OD720) 
  
MultiCultiData121 <- MultiCultiData %>%   
  group_by(SampleID, Day, ToD, time_h) %>% 
  summarize(Run, SampleID, Strain, ExpDate, Filename, Tube, time_h, ToD, Day, ExpDate, Actinic_par, OD680, OD720, DeltaOD, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, meanActinic_par_h = mean(Actinic_par), meanOD680_h = mean(OD680), meanOD720_h = mean(OD720), meanDeltaOD_h = mean(DeltaOD)) %>%
  ungroup() %>% 
  select(-c(Actinic_par, OD680, OD720, DeltaOD)) %>% 
  unique()
```

# Merge selected Runs - 900uE

```{r Mere selected Runs}
MultiCultiData900<-rbind(MultiCultiData65, MultiCultiData62, MultiCultiData60, MultiCultiData75)
  rm(MultiCultiData65, MultiCultiData62, MultiCultiData60, MultiCultiData75)
  
MultiCultiData900<-MultiCultiData900 %>% 
  filter(Par_ue == 900) %>% 
  filter(Strain == "BA120R" | Strain == "BA132R" | Strain == "BA60G" | Strain == "BA124G") %>% 
  
  rename(E_days=Day) %>% 
  rename(FilenameMC=Filename) %>% 
  rename(Time_h=time_h)
```

# Merge selected Runs - 600uE

```{r Mere selected Runs}
MultiCultiData600<-rbind(MultiCultiData50, MultiCultiData77, MultiCultiData121)
  rm(MultiCultiData50, MultiCultiData77, MultiCultiData121)
  
MultiCultiData600<-MultiCultiData600 %>% 
  filter(Run != 77) %>% 
  filter(Par_ue == 600) %>% 
  filter(Strain == "BA48R" | Strain == "BA127R" | Strain == "BA56G" | Strain == "BA77G") %>% 
  rename(E_days=Day) %>% 
  rename(FilenameMC=Filename) %>% 
  rename(Time_h=time_h)
```

# Merge selected Runs - colour

```{r Mere selected Runs}
MultiCultiDataColour<-MultiCultiData34 
  rm(MultiCultiData34)
  
MultiCultiDataColour<-MultiCultiDataColour %>% 
  rename(E_days=Day) %>% 
  rename(FilenameMC=Filename) %>% 
  rename(Time_h=time_h)
```

# Merge selected Runs - transfer

```{r Mere selected Runs}
MultiCultiDataTrans<-rbind(MultiCultiData64, MultiCultiData67)
  rm(MultiCultiData64, MultiCultiData67)
  
MultiCultiDataTrans<-MultiCultiDataTrans %>% 
  rename(E_days=Day) %>% 
  rename(FilenameMC=Filename) %>% 
  rename(Time_h=time_h)
```

# Add facets labels and change strain name to create plot

```{r add facets labels and change strain names}
MultiCultiData900$facetsPar_ue = factor(MultiCultiData900$O2, labels = c("PAR~(µmol~photons~m^{-2}~s^{-1})"))
MultiCultiData900$facetsPhotoperiod = factor(MultiCultiData900$WL, labels = c("Photoperiod~(h)"))
MultiCultiData900 <- MultiCultiData900 %>% 
    mutate(Strain=case_when(Strain=="BA120R"~"PE-rich_120",
         Strain=="BA132R"~"PE-rich_132",
        Strain=="BA60G"~"PC-rich_060",
         Strain=="BA124G"~"PC-rich_124")) 


MultiCultiData600$facetsPar_ue = factor(MultiCultiData600$O2, labels = c("PAR~(µmol~photons~m^{-2}~s^{-1})"))
MultiCultiData600$facetsPhotoperiod = factor(MultiCultiData600$WL, labels = c("Photoperiod~(h)"))
MultiCultiData600 <- MultiCultiData600 %>% 
    mutate(Strain=case_when(Strain=="BA127R"~"PE-rich_127",
         Strain=="BA48R"~"PE-rich_048",
        Strain=="BA56G"~"PC-rich_056",
         Strain=="BA77G"~"PC-rich_077")) 


MultiCultiDataColour$facetsPar_ue = factor(MultiCultiDataColour$O2, labels = c("PAR~(µmol~photons~m^{-2}~s^{-1})"))
MultiCultiDataColour$facetsPhotoperiod = factor(MultiCultiDataColour$WL, labels = c("Photoperiod~(h)"))
MultiCultiDataColour <- MultiCultiDataColour %>% 
    mutate(Strain=case_when(Strain=="BA60G"~"PC-rich_060")) 


MultiCultiDataTrans$facetsPar_ue = factor(MultiCultiDataTrans$O2, labels = c("PAR~(µmol~photons~m^{-2}~s^{-1})"))
MultiCultiDataTrans$facetsPhotoperiod = factor(MultiCultiDataTrans$WL, labels = c("Photoperiod~(h)"))
MultiCultiDataTrans <- MultiCultiDataTrans %>% 
    mutate(Strain=case_when(Strain=="BA127R"~"PE-rich_127",
         Strain=="BA48R"~"PE-rich_048",
        Strain=="BA56G"~"PC-rich_056",
         Strain=="BA77G"~"PC-rich_077")) 
```


# Create GrowthCurve plot - 900

```{r create GrowthCurve plot, warning = FALSE}
MultiCultiData900 %>%
  filter(Time_h <120) %>% 
  ggplot() +
  geom_area(aes(x = Time_h, y = meanActinic_par_h), size = 0.1, fill = "tan1", alpha = 0.6) +
  geom_line(aes(x = Time_h, y = meanOD680_h, colour = as.factor(Strain)), size = 0.5, show.legend = F) +
  geom_line(aes(x = Time_h, y = meanOD720_h, colour = as.factor(Strain)), size = 0.5, show.legend = F) +
  geom_line(aes(x = Time_h, y = meanDeltaOD_h, colour = as.factor(Strain)), size = 0.5, show.legend = F) +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4"), name="") +
  labs(y = "Optical density", x = "Elapsed time (h)") +
  ggh4x::facet_nested(cols = vars(facetsPhotoperiod, Photoperiod), rows = vars(Strain), labeller = label_parsed) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.1,0.95),
        legend.key.height= unit(0.005, 'cm'),
        legend.spacing.x = unit(0.01, 'cm'),
        legend.text = element_text(size=10))

```

# Save plot 

```{r save plot}
ggsave(file = file.path(PlotsPath, paste("GrowthCurve900_SupPlot",".png",sep = "")), height=10, width= 8,  dpi = 300, limitsize = TRUE)
```

# Create GrowthCurve plot - 600

```{r create GrowthCurve plot, warning = FALSE}

data_text16 <- data.frame(Photoperiod = c(16), Strain  = c("PC-rich_056", "PC-rich_077", "PE-rich_048", "PE-rich_127"), label = c('µ = 0.025', 'µ = 0.068', 'µ = 0.055', 'µ = 0.070'))

data_text24 <- data.frame(Photoperiod = c(24), Strain  = c("PC-rich_056", "PC-rich_077", "PE-rich_048", "PE-rich_127"), label = c('µ = 0.048', 'µ = 0.091', 'µ = 0.062', 'µ = 0.064'))

MultiCultiData600 %>%
  ggplot() +
  geom_area(aes(x = Time_h, y = meanActinic_par_h), size = 0.1, fill = "tan1", alpha = 0.6) +
  geom_line(aes(x = Time_h, y = meanOD680_h, colour = as.factor(Strain)), size = 0.5, show.legend = F) +
  geom_line(aes(x = Time_h, y = meanOD720_h, colour = as.factor(Strain)), size = 0.5, show.legend = F) +
  geom_line(aes(x = Time_h, y = meanDeltaOD_h, colour = as.factor(Strain)), size = 0.5, show.legend = F) +
  geom_text(data=data_text16, aes(x=150, y=1, label=label), size=3.7) +
  geom_text(data=data_text24, aes(x=150, y=1, label=label), size=3.7) +
  scale_y_continuous(breaks=seq(0, 1, by = 0.25)) +
  coord_cartesian(ylim = c(0, 1.2)) +
  
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4"), name="") +
  labs(y = "Optical density", x = "Elapsed time (h)") +
  ggh4x::facet_nested(cols = vars(Photoperiod), rows = vars(Strain), labeller = label_parsed) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.1,0.95),
        legend.key.height= unit(0.005, 'cm'),
        legend.spacing.x = unit(0.01, 'cm'),
        legend.text = element_text(size=10))
```
# Save plot 

```{r save plot}
ggsave(file = file.path(PlotsPath, paste("GrowthCurve600_SupPlot",".png",sep = "")), height=10, width= 8,  dpi = 300, limitsize = TRUE)
```

# Create GrowthCurve plot - Colour

```{r create GrowthCurve plot, warning = FALSE}
MultiCultiDataColour %>%
  ggplot() +
  geom_area(aes(x = Time_h, y = meanActinic_par_h), size = 0.1, fill = "tan1", alpha = 0.6) +
  geom_line(aes(x = Time_h, y = meanOD680_h, colour = as.factor(Strain)), size = 0.5, show.legend = F) +
  geom_line(aes(x = Time_h, y = meanOD720_h, colour = as.factor(Strain)), size = 0.5, show.legend = F) +
  geom_line(aes(x = Time_h, y = meanDeltaOD_h, colour = as.factor(Strain)), size = 0.5, show.legend = F) +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4"), name="") +
    labs(y = "Optical density", x = "Elapsed time (h)") +
  # labs(y = "Optical density ("~OD[680]~")", x = "Elapsed time (h)") +
  ggh4x::facet_nested(cols = vars(WL), rows = vars(Par_ue), labeller = label_parsed) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.1,0.95),
        legend.key.height= unit(0.005, 'cm'),
        legend.spacing.x = unit(0.01, 'cm'),
        legend.text = element_text(size=10))
```
# Save plot 

```{r save plot}
ggsave(file = file.path(PlotsPath, paste("GrowthCurveColour_SupPlot",".png",sep = "")), height=10, width= 8,  dpi = 300, limitsize = TRUE)
```

# Create GrowthCurve plot - Trans

```{r create GrowthCurve plot, warning = FALSE}

data_text6430 <- data.frame(Run = c(64), Par_ue = c(30), Strain  = c("PC-rich_056", "PC-rich_077", "PE-rich_048", "PE-rich_127"), label = c('µ = 0.014', 'µ = 0.018', 'µ = 0.019', 'µ = 0.025'))

data_text64900 <- data.frame(Run = c(64), Par_ue = c(900), Strain  = c("PC-rich_056", "PC-rich_077", "PE-rich_048", "PE-rich_127"), label = c('µ = 0.101', 'µ = 0.105', 'µ = 0.072', 'µ = 0.055'))



data_text6730 <- data.frame(Run = c(67), Par_ue = c(30), Strain  = c("PC-rich_056", "PC-rich_077", "PE-rich_048", "PE-rich_127"), label = c('µ = 0.013', 'µ = 0.023', 'µ = 0.019', 'µ = 0'))

data_text67900 <- data.frame(Run = c(67), Par_ue = c(900), Strain  = c("PC-rich_056", "PC-rich_077", "PE-rich_048", "PE-rich_127"), label = c('µ = 0.086', 'µ = 0.090', 'µ = 0.074', 'µ = 0'))


MultiCultiDataTrans %>%
  ggplot() +
  geom_area(aes(x = Time_h, y = meanActinic_par_h), size = 0.1, fill = "tan1", alpha = 0.6) +
  geom_line(aes(x = Time_h, y = meanOD680_h, colour = as.factor(Strain)), size = 0.5, show.legend = F) +
  geom_line(aes(x = Time_h, y = meanOD720_h, colour = as.factor(Strain)), size = 0.5, show.legend = F) +
  geom_line(aes(x = Time_h, y = meanDeltaOD_h, colour = as.factor(Strain)), size = 0.5, show.legend = F) +
  geom_text(data=data_text6430, aes(x=150, y=1, label=label), size=3.7) +
  geom_text(data=data_text6730, aes(x=150, y=1, label=label), size=3.7) +
  
  geom_text(data=data_text64900, aes(x=150, y=1, label=label), size=3.7) +
  geom_text(data=data_text67900, aes(x=150, y=1, label=label), size=3.7) +
  
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4"), name="") +
    labs(y = "Optical density", x = "Elapsed time (h)") +
  # labs(y = "Optical density ("~OD[680]~")", x = "Elapsed time (h)") +
  ggh4x::facet_nested(cols = vars(Run, Par_ue), rows = vars(Strain), labeller = label_parsed) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.1,0.95),
        legend.key.height= unit(0.005, 'cm'),
        legend.spacing.x = unit(0.01, 'cm'),
        legend.text = element_text(size=10))
```
# Save plot 

```{r save plot}
ggsave(file = file.path(PlotsPath, paste("GrowthCurveTrans_SupPlot",".png",sep = "")), height=10, width= 8,  dpi = 300, limitsize = TRUE)
```

# Create preliminary plot - loop

```{r create preliminary plot, warning = FALSE}
MultiCultiData600 %>%
  ggplot() +
  geom_line(aes(x = meanOD720_h, y = meanDeltaOD_h, colour = as.factor(Strain)), size = 0.7, show.legend = T) +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4"), name="") +
  ggh4x::facet_nested(cols = vars(Photoperiod), rows = vars(Strain), labeller = label_parsed) +
  theme_bw() 
```

# Cleaning df before saving as rds and removed unnecessary files from the environment

```{r cleanifng d}
rm(MultiCultiData)
```

# Save Rds for further analysis

```{r save rds}
saveRDS(MultiCultiData900, file.path(DataOut, paste(Project, "Processed_GrowthCurve_900.Rds", sep = "_"), fsep = .Platform$file.sep), ascii = FALSE, version = NULL, compress = "xz", refhook = NULL)

saveRDS(MultiCultiData600, file.path(DataOut, paste(Project, "Processed_GrowthCurve_600.Rds", sep = "_"), fsep = .Platform$file.sep), ascii = FALSE, version = NULL, compress = "xz", refhook = NULL)

saveRDS(MultiCultiDataColour, file.path(DataOut, paste(Project, "Processed_GrowthCurve_Colour.Rds", sep = "_"), fsep = .Platform$file.sep), ascii = FALSE, version = NULL, compress = "xz", refhook = NULL)

saveRDS(MultiCultiDataTrans, file.path(DataOut, paste(Project, "Processed_GrowthCurve_Trans.Rds", sep = "_"), fsep = .Platform$file.sep), ascii = FALSE, version = NULL, compress = "xz", refhook = NULL)
```

# Variable names used in Data Dictionary

```{r}
colnames(MultiCultiData900)
```



